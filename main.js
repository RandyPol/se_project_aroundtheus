!function(){"use strict";function e(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var t=class{constructor(e){this._popupElement=document.querySelector(e),this._escCloseHandler=this._handleEscClose.bind(this)}open(){this._popupElement.classList.add("modal_opened"),document.addEventListener("keydown",this._escCloseHandler)}close(){this._popupElement.classList.remove("modal_opened"),document.removeEventListener("keydown",this._escCloseHandler)}_handleEscClose(e){"Escape"===e.key&&this.close()}setEventListeners(){this._popupElement.querySelector(".modal__button-close").addEventListener("click",this.close.bind(this)),this._popupElement.addEventListener("mousedown",(e=>{e.target===e.currentTarget&&this.close()}))}};class r extends t{constructor(e,t){super(t),this._handleSubmit=e,this._form=this._popupElement.querySelector(".form"),this._inputList=this._form.querySelectorAll(".form__input"),this._submitButton=this._form.querySelector(".form__submit"),this._submitButtonnText=this._submitButton.textContent}_getInputValues(){const e={};return this._inputList.forEach((t=>{e[t.name]=t.value})),e}renderLoading(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Saving...";this._submitButton.textContent=e?t:this._submitButtonnText}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this.renderLoading(!0),this._handleSubmit(this._getInputValues())}))}setInputValues(e){this._inputList.forEach((t=>{t.value=e[t.name]}))}close(){super.close(),this._form.reset()}}document.querySelector(".cards"),document.querySelector("#modalEdit");const s=document.querySelector(".profile__name-edit"),n=(document.querySelector("#modalAdd"),document.querySelector(".profile__add-button")),i=(document.querySelector("#modalDelete").querySelector(".modal__button-yes"),document.querySelector("#modalEditAvatar"),document.querySelector(".profile__avatar-edit")),a=(document.querySelector(".profile__avatar"),new class{constructor(e){this._baseUrl=e.baseUrl,this._headers=e.headers}_checkResponse(e){return e.ok?e.json():Promise.reject(`Error: ${e.status}`)}_request(e,t){return fetch(e,t).then(this._checkResponse)}getInitialCards(){return this._request(`${this._baseUrl}/cards`,{headers:this._headers})}getUserInfo(){return this._request(`${this._baseUrl}/users/me`,{headers:this._headers})}loadData(){return Promise.all([this.getUserInfo(),this.getInitialCards()])}patchUserInfo(e){return this._request(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify(e)})}postNewCard(e){return this._request(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify(e)})}deleteCard(e){return this._request(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers})}putCardLike(e){return this._request(`${this._baseUrl}/cards/likes/${e}`,{method:"PUT",headers:this._headers})}deleteCardLike(e){return this._request(`${this._baseUrl}/cards/likes/${e}`,{method:"DELETE",headers:this._headers})}patchUserAvatar(e){return this._request(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify(e)})}}({baseUrl:"https://around.nomoreparties.co/v1/group-12",headers:{authorization:"04304a71-d9c0-49b2-8283-cfc2c5afdf53","Content-Type":"application/json"}})),o=e=>{e.getCardLikeStatus()?a.deleteCardLike(e.getId()).then((t=>{e.toggleLikeButton(t.likes.length)})).catch((e=>{console.log(e)})):a.putCardLike(e.getId()).then((t=>{e.toggleLikeButton(t.likes.length)})).catch((e=>{console.log(e)}))},l=e=>{m.open(e)},c=e=>{_.open(e.target.src,e.target.alt)},d=new class{constructor(e,t){let{renderer:r}=e;this._renderer=r,this._container=document.querySelector(t)}addItem(e,t){const r=this._renderer(e,t);this._container.prepend(r)}renderInitialCards(e,t){e.forEach((e=>{this.addItem(e,t)}))}}({renderer:function(t,r){return new class{constructor(t,r,s,n,i,a){e(this,"_handleTrashButtonClick",(()=>{this._deleteCardModal(this)})),e(this,"_handleHeartButtonClick",(()=>{this._handleHeartClick(this)})),this._cardData=t,this._cardName=t.name,this._cardLink=t.link,this._cardLikes=t.likes.length,this._cardId=t._id,this._templateSelector=r,this._handleImageClick=s,this._deleteCardModal=n,this._currentUserId=i,this._handleHeartClick=a}_getTemplate(){return document.querySelector(this._templateSelector).content.querySelector(".card").cloneNode(!0)}_setEventListeners(){this._cardLikeButton.addEventListener("click",this._handleHeartButtonClick),this._trashButton&&this._trashButton.addEventListener("click",this._handleTrashButtonClick),this._cardElementImage.addEventListener("click",this._handleImageClick)}deleteCard(){this._cardElement.remove(),this._cardElement=null}getCardLikeStatus(){return this._cardLikeButton.classList.contains("card__heart-button_isActive")}toggleLikeButton(e){this._cardLikeButton.classList.toggle("card__heart-button_isActive"),this._cardElementLikes.textContent=e}getId(){return this._cardId}generateCard(){this._cardElement=this._getTemplate(),this._cardElementImage=this._cardElement.querySelector(".card__column-image"),this._cardElementLikes=this._cardElement.querySelector(".card__heart-count");const e=this._cardElement.querySelector(".card__column-image-title");return this._trashButton=this._cardElement.querySelector(".card__trash-button"),this._cardData.owner._id!==this._currentUserId&&(this._trashButton.remove(),this._trashButton=null),this._cardLikeButton=this._cardElement.querySelector(".card__heart-button"),this._cardData.likes.some((e=>e._id===this._currentUserId))&&this._cardLikeButton.classList.add("card__heart-button_isActive"),this._setEventListeners(),this._cardElementImage.alt=this._cardName,this._cardElementImage.src=this._cardLink,this._cardElementLikes.textContent=this._cardLikes,e.textContent=this._cardName,this._cardElement}}(t,"#card",c,l,r,o).generateCard()}},".cards"),h={};var u;u={inputSelector:".form__input",submitButtonSelector:".form__submit",inactiveButtonClass:"form__button_inactive",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active",formSelector:".form"},Array.from(document.querySelectorAll(u.formSelector)).forEach((e=>{const t=new class{constructor(e,t){this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._formElement=t}_hideInputError(e){this._errorElement=this._formElement.querySelector(`.${e.id}-input-error`),e.classList.remove(this._inputErrorClass),this._errorElement.classList.remove(this._errorClass),this._errorElement.textContent=""}_showInputError(e,t){const r=this._formElement.querySelector(`.${e.id}-input-error`);e.classList.add(this._inputErrorClass),r.textContent=t,r.classList.add(this._errorClass)}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)}_hasInvalidInput(){return this.inputList.some((e=>!e.validity.valid))}_toggleButtonState(){this._hasInvalidInput(this.inputList)?(this.buttonElement.classList.add(this._inactiveButtonClass),this.buttonElement.disabled=!0):(this.buttonElement.classList.remove(this._inactiveButtonClass),this.buttonElement.disabled=!1)}_setEventListeners(){this.inputList=[...this._formElement.querySelectorAll(this._inputSelector)],this.buttonElement=this._formElement.querySelector(this._submitButtonSelector),this._toggleButtonState(),this.inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButtonState()}))}))}resetValidation(){this._formElement.reset(),this._toggleButtonState(),this.inputList.forEach((e=>{this._hideInputError(e)}))}enableValidation(){this._setEventListeners()}}(u,e),r=e.getAttribute("name");h[r]=t,t.enableValidation()}));const _=new class extends t{constructor(e,t,r){super(e),this._image=this._popupElement.querySelector(t),this._caption=this._popupElement.querySelector(r)}open(e,t){super.open(),this._image.src=e,this._image.alt=t,this._caption.textContent=t}}("#modalPicture",".modal__picture-full",".modal__piture-paragraph");_.setEventListeners();const m=new class extends t{constructor(e,t){super(e),this._handleCardDelete=t}open(e){super.open(),this._confirmDelete=()=>{this._handleCardDelete(e)},this._popupElement.querySelector(".modal__button-yes").addEventListener("click",this._confirmDelete)}close(){super.close(),this._popupElement.querySelector(".modal__button-yes").removeEventListener("click",this._confirmDelete)}}("#modalDelete",(e=>{a.deleteCard(e.getId()).then((()=>{e.deleteCard(),m.close()})).catch((e=>{console.log(e)}))}));m.setEventListeners();const p=new class{constructor(e){let{nameSelector:t,jobSelector:r,avatarSelector:s}=e;this._name=document.querySelector(t),this._about=document.querySelector(r),this._avatar=document.querySelector(s)}getUserInfo(){return{name:this._name.textContent,about:this._about.textContent,avatar:this._avatar.src}}setUserInfo(e){let{name:t,about:r,avatar:s}=e;this._name.textContent=t,this._about.textContent=r,this._avatar.src=s}}({nameSelector:".profile__name",jobSelector:".profile__role",avatarSelector:".profile__avatar"}),E=new r((e=>{a.patchUserInfo(e).then((e=>{p.setUserInfo(e),E.close()})).catch((e=>{console.log(e)})).finally((()=>E.renderLoading(!1)))}),"#modalEdit");E.setEventListeners();const v=new r((e=>{a.postNewCard(e).then((e=>{d.addItem(e,e.owner._id),v.close()})).catch((e=>{console.log(e)})).finally((()=>v.renderLoading(!1)))}),"#modalAdd");v.setEventListeners();const g=new r((e=>{let{link:t}=e;a.patchUserAvatar({avatar:t}).then((e=>{p.setUserInfo(e),g.close()})).catch((e=>{console.log(e)})).finally((()=>g.renderLoading(!1)))}),"#modalEditAvatar");g.setEventListeners(),s.addEventListener("click",(()=>{h.profileForm.resetValidation(),E.setInputValues(p.getUserInfo()),E.open()})),n.addEventListener("click",(()=>{h.cardForm.resetValidation(),v.open()})),i.addEventListener("click",(()=>{h.avatarForm.resetValidation(),g.open()})),a.loadData().then((e=>{const[t,r]=e;d.renderInitialCards(r,t._id),p.setUserInfo(t)})).catch((e=>{console.log(e)}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TTBMLEVBQW1CLElBQUl2TCxHQWJFLElBQXNCLElBQW5CZ0csS0FBTWtGLEdBQVEsRUFDOUN2SixFQUNHK0IsZ0JBQWdCLENBQUV3SCxXQUNsQnZJLE1BQU1ULElBQ0x3SSxFQUFTUyxZQUFZakosR0FDckJxSixFQUFpQi9MLE9BQU8sSUFFekIyRSxPQUFPQyxJQUNOQyxRQUFRQyxJQUFJRixFQUFJLElBRWpCaUgsU0FBUSxJQUFNRSxFQUFpQnRLLGVBQWMsSUFBTyxHQUt2RCxvQkFFRnNLLEVBQWlCMUwsb0JBV2pCMkIsRUFBa0JqQyxpQkFBaUIsU0FMSixLQUM3Qm1JLEVBQTRCLFlBQUVtQyxrQkFDOUJ1QixFQUFxQi9KLGVBQWVxSixFQUFTN0gsZUFDN0N1SSxFQUFxQmhNLE1BQU0sSUFVN0JxQyxFQUFtQmxDLGlCQUFpQixTQUpULEtBQ3pCbUksRUFBeUIsU0FBRW1DLGtCQUMzQnlCLEVBQWlCbE0sTUFBTSxJQVV6QnNDLEVBQWlCbkMsaUJBQWlCLFNBSlIsS0FDeEJtSSxFQUEyQixXQUFFbUMsa0JBQzdCMEIsRUFBaUJuTSxNQUFNLElBT3pCdUMsRUFDR21CLFdBQ0FILE1BQU1yQixJQUNMLE1BQU9rSyxFQUFVaEcsR0FBWWxFLEVBQzdCdUQsRUFBWVMsbUJBQW1CRSxFQUFVZ0csRUFBU3JGLEtBQ2xEdUUsRUFBU1MsWUFBWUssRUFBUyxJQUUvQnJILE9BQU9DLElBQ05DLFFBQVFDLElBQUlGLEVBQUksRyIsInNvdXJjZXMiOlsid2VicGFjazovL3NlX3Byb2plY3RfYXJvdW5kdGhldXMvLi9zcmMvY29tcG9uZW50cy9DYXJkLmpzIiwid2VicGFjazovL3NlX3Byb2plY3RfYXJvdW5kdGhldXMvLi9zcmMvY29tcG9uZW50cy9Qb3B1cC5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X2Fyb3VuZHRoZXVzLy4vc3JjL2NvbXBvbmVudHMvUG9wdXBXaXRoRm9ybS5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X2Fyb3VuZHRoZXVzLy4vc3JjL3V0aWxzL2NvbnN0YW50cy5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X2Fyb3VuZHRoZXVzLy4vc3JjL3BhZ2VzL2luZGV4LmpzIiwid2VicGFjazovL3NlX3Byb2plY3RfYXJvdW5kdGhldXMvLi9zcmMvY29tcG9uZW50cy9BcGkuanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9hcm91bmR0aGV1cy8uL3NyYy9jb21wb25lbnRzL1NlY3Rpb24uanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9hcm91bmR0aGV1cy8uL3NyYy9jb21wb25lbnRzL0Zvcm1WYWxpZGF0b3IuanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9hcm91bmR0aGV1cy8uL3NyYy9jb21wb25lbnRzL1BvcHVwV2l0aEltYWdlLmpzIiwid2VicGFjazovL3NlX3Byb2plY3RfYXJvdW5kdGhldXMvLi9zcmMvY29tcG9uZW50cy9Qb3B1cERlbGV0ZUNhcmQuanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9hcm91bmR0aGV1cy8uL3NyYy9jb21wb25lbnRzL1VzZXJJbmZvLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNsYXNzIENhcmQge1xuICBjb25zdHJ1Y3RvcihcbiAgICBjYXJkRGF0YSxcbiAgICB0ZW1wbGF0ZVNlbGVjdG9yLFxuICAgIGhhbmRsZUltYWdlQ2xpY2ssXG4gICAgZGVsZXRlQ2FyZE1vZGFsLFxuICAgIGN1cnJlbnRVc2VySWQsXG4gICAgaGFuZGxlSGVhcnRDbGlja1xuICApIHtcbiAgICB0aGlzLl9jYXJkRGF0YSA9IGNhcmREYXRhXG4gICAgdGhpcy5fY2FyZE5hbWUgPSBjYXJkRGF0YS5uYW1lXG4gICAgdGhpcy5fY2FyZExpbmsgPSBjYXJkRGF0YS5saW5rXG4gICAgdGhpcy5fY2FyZExpa2VzID0gY2FyZERhdGEubGlrZXMubGVuZ3RoXG4gICAgdGhpcy5fY2FyZElkID0gY2FyZERhdGEuX2lkXG4gICAgdGhpcy5fdGVtcGxhdGVTZWxlY3RvciA9IHRlbXBsYXRlU2VsZWN0b3JcbiAgICB0aGlzLl9oYW5kbGVJbWFnZUNsaWNrID0gaGFuZGxlSW1hZ2VDbGlja1xuICAgIHRoaXMuX2RlbGV0ZUNhcmRNb2RhbCA9IGRlbGV0ZUNhcmRNb2RhbFxuICAgIHRoaXMuX2N1cnJlbnRVc2VySWQgPSBjdXJyZW50VXNlcklkXG4gICAgdGhpcy5faGFuZGxlSGVhcnRDbGljayA9IGhhbmRsZUhlYXJ0Q2xpY2tcbiAgfVxuXG4gIF9nZXRUZW1wbGF0ZSgpIHtcbiAgICAvLyBjb2RlIHRvIGdldCB0aGUgY2FyZCB0ZW1wbGF0ZWdpdCBzdGF0dXNcbiAgICBjb25zdCBjYXJkRWxlbWVudCA9IGRvY3VtZW50XG4gICAgICAucXVlcnlTZWxlY3Rvcih0aGlzLl90ZW1wbGF0ZVNlbGVjdG9yKVxuICAgICAgLmNvbnRlbnQucXVlcnlTZWxlY3RvcignLmNhcmQnKVxuICAgICAgLmNsb25lTm9kZSh0cnVlKVxuXG4gICAgcmV0dXJuIGNhcmRFbGVtZW50XG4gIH1cblxuICBfc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgLy8gY29kZSB0byBzZXQgZXZlbnQgbGlzdGVuZXJzIGZvciB0aGUgY2FyZFxuXG4gICAgLy8gTGlrZSBmZWF0dXJlIHRvZ2dsZVxuICAgIHRoaXMuX2NhcmRMaWtlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5faGFuZGxlSGVhcnRCdXR0b25DbGljaylcblxuICAgIC8vIEVyYXNlIGNhcmQgZmVhdHVyZVxuICAgIGlmICh0aGlzLl90cmFzaEJ1dHRvbikge1xuICAgICAgdGhpcy5fdHJhc2hCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLl9oYW5kbGVUcmFzaEJ1dHRvbkNsaWNrKVxuICAgIH1cblxuICAgIC8vIFBpY3R1cmUgZnVsbCBtb2RhbFxuICAgIHRoaXMuX2NhcmRFbGVtZW50SW1hZ2UuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLl9oYW5kbGVJbWFnZUNsaWNrKVxuICB9XG5cbiAgX2hhbmRsZVRyYXNoQnV0dG9uQ2xpY2sgPSAoKSA9PiB7XG4gICAgLy8gY29kZSBmb3IgaGFuZGxpbmcgdHJhc2ggYnV0dG9uIGNsaWNrIGV2ZW50XG4gICAgdGhpcy5fZGVsZXRlQ2FyZE1vZGFsKHRoaXMpXG4gIH1cblxuICBkZWxldGVDYXJkKCkge1xuICAgIHRoaXMuX2NhcmRFbGVtZW50LnJlbW92ZSgpXG4gICAgdGhpcy5fY2FyZEVsZW1lbnQgPSBudWxsXG4gIH1cblxuICBfaGFuZGxlSGVhcnRCdXR0b25DbGljayA9ICgpID0+IHtcbiAgICB0aGlzLl9oYW5kbGVIZWFydENsaWNrKHRoaXMpXG4gIH1cblxuICBnZXRDYXJkTGlrZVN0YXR1cygpIHtcbiAgICByZXR1cm4gdGhpcy5fY2FyZExpa2VCdXR0b24uY2xhc3NMaXN0LmNvbnRhaW5zKFxuICAgICAgJ2NhcmRfX2hlYXJ0LWJ1dHRvbl9pc0FjdGl2ZSdcbiAgICApXG4gIH1cblxuICB0b2dnbGVMaWtlQnV0dG9uKGNhcmRMaWtlcykge1xuICAgIHRoaXMuX2NhcmRMaWtlQnV0dG9uLmNsYXNzTGlzdC50b2dnbGUoJ2NhcmRfX2hlYXJ0LWJ1dHRvbl9pc0FjdGl2ZScpXG4gICAgdGhpcy5fY2FyZEVsZW1lbnRMaWtlcy50ZXh0Q29udGVudCA9IGNhcmRMaWtlc1xuICB9XG5cbiAgZ2V0SWQoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2NhcmRJZFxuICB9XG5cbiAgZ2VuZXJhdGVDYXJkKCkge1xuICAgIC8vIGNvZGUgdG8gZ2VuZXJhdGUgYW5kIHJldHVybiB0aGUgY2FyZCBlbGVtZW50IHBvcHVsYXRlZCB3aXRoIGRhdGFcbiAgICB0aGlzLl9jYXJkRWxlbWVudCA9IHRoaXMuX2dldFRlbXBsYXRlKClcbiAgICB0aGlzLl9jYXJkRWxlbWVudEltYWdlID0gdGhpcy5fY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgICcuY2FyZF9fY29sdW1uLWltYWdlJ1xuICAgIClcbiAgICB0aGlzLl9jYXJkRWxlbWVudExpa2VzID1cbiAgICAgIHRoaXMuX2NhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jYXJkX19oZWFydC1jb3VudCcpXG5cbiAgICBjb25zdCBjYXJkRWxlbWVudFRpdGxlID0gdGhpcy5fY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgICcuY2FyZF9fY29sdW1uLWltYWdlLXRpdGxlJ1xuICAgIClcbiAgICAvLyBIaWRlIHRyYXNoIGJ1dHRvbiBpZiB0aGUgY2FyZCBpcyBub3Qgb3duZWQgYnkgdGhlIGN1cnJlbnQgdXNlclxuICAgIHRoaXMuX3RyYXNoQnV0dG9uID0gdGhpcy5fY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcignLmNhcmRfX3RyYXNoLWJ1dHRvbicpXG5cbiAgICBpZiAodGhpcy5fY2FyZERhdGEub3duZXIuX2lkICE9PSB0aGlzLl9jdXJyZW50VXNlcklkKSB7XG4gICAgICB0aGlzLl90cmFzaEJ1dHRvbi5yZW1vdmUoKVxuICAgICAgdGhpcy5fdHJhc2hCdXR0b24gPSBudWxsXG4gICAgfVxuXG4gICAgdGhpcy5fY2FyZExpa2VCdXR0b24gPSB0aGlzLl9jYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgJy5jYXJkX19oZWFydC1idXR0b24nXG4gICAgKVxuICAgIC8vIGNoZWNrIGlmIGNhcmQgaXMgbGlrZWQgYnkgdXNlclxuICAgIGlmICh0aGlzLl9jYXJkRGF0YS5saWtlcy5zb21lKChsaWtlKSA9PiBsaWtlLl9pZCA9PT0gdGhpcy5fY3VycmVudFVzZXJJZCkpIHtcbiAgICAgIHRoaXMuX2NhcmRMaWtlQnV0dG9uLmNsYXNzTGlzdC5hZGQoJ2NhcmRfX2hlYXJ0LWJ1dHRvbl9pc0FjdGl2ZScpXG4gICAgfVxuICAgIC8vIFNldCBsaXN0ZW5lcnNcbiAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVycygpXG5cbiAgICAvLyBBZGQgQ29udGVudFxuICAgIHRoaXMuX2NhcmRFbGVtZW50SW1hZ2UuYWx0ID0gdGhpcy5fY2FyZE5hbWVcbiAgICB0aGlzLl9jYXJkRWxlbWVudEltYWdlLnNyYyA9IHRoaXMuX2NhcmRMaW5rXG4gICAgdGhpcy5fY2FyZEVsZW1lbnRMaWtlcy50ZXh0Q29udGVudCA9IHRoaXMuX2NhcmRMaWtlc1xuICAgIGNhcmRFbGVtZW50VGl0bGUudGV4dENvbnRlbnQgPSB0aGlzLl9jYXJkTmFtZVxuXG4gICAgcmV0dXJuIHRoaXMuX2NhcmRFbGVtZW50XG4gIH1cbn1cbmV4cG9ydCBkZWZhdWx0IENhcmRcbiIsImNsYXNzIFBvcHVwIHtcbiAgY29uc3RydWN0b3IocG9wdXBTZWxlY3Rvcikge1xuICAgIHRoaXMuX3BvcHVwRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IocG9wdXBTZWxlY3RvcilcbiAgICB0aGlzLl9lc2NDbG9zZUhhbmRsZXIgPSB0aGlzLl9oYW5kbGVFc2NDbG9zZS5iaW5kKHRoaXMpXG4gIH1cblxuICBvcGVuKCkge1xuICAgIHRoaXMuX3BvcHVwRWxlbWVudC5jbGFzc0xpc3QuYWRkKCdtb2RhbF9vcGVuZWQnKVxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCB0aGlzLl9lc2NDbG9zZUhhbmRsZXIpXG4gIH1cblxuICBjbG9zZSgpIHtcbiAgICB0aGlzLl9wb3B1cEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnbW9kYWxfb3BlbmVkJylcbiAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdrZXlkb3duJywgdGhpcy5fZXNjQ2xvc2VIYW5kbGVyKVxuICB9XG5cbiAgX2hhbmRsZUVzY0Nsb3NlKGV2dCkge1xuICAgIGlmIChldnQua2V5ID09PSAnRXNjYXBlJykge1xuICAgICAgdGhpcy5jbG9zZSgpXG4gICAgfVxuICB9XG5cbiAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgdGhpcy5fcG9wdXBFbGVtZW50XG4gICAgICAucXVlcnlTZWxlY3RvcignLm1vZGFsX19idXR0b24tY2xvc2UnKVxuICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5jbG9zZS5iaW5kKHRoaXMpKVxuXG4gICAgdGhpcy5fcG9wdXBFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIChldnQpID0+IHtcbiAgICAgIGlmIChldnQudGFyZ2V0ID09PSBldnQuY3VycmVudFRhcmdldCkge1xuICAgICAgICB0aGlzLmNsb3NlKClcbiAgICAgIH1cbiAgICB9KVxuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IFBvcHVwXG4iLCJpbXBvcnQgUG9wdXAgZnJvbSAnLi9Qb3B1cC5qcydcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXBXaXRoRm9ybSBleHRlbmRzIFBvcHVwIHtcbiAgY29uc3RydWN0b3IoaGFuZGxlU3VibWl0LCBwb3B1cFNlbGVjdG9yKSB7XG4gICAgc3VwZXIocG9wdXBTZWxlY3RvcilcbiAgICB0aGlzLl9oYW5kbGVTdWJtaXQgPSBoYW5kbGVTdWJtaXRcbiAgICB0aGlzLl9mb3JtID0gdGhpcy5fcG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5mb3JtJylcbiAgICB0aGlzLl9pbnB1dExpc3QgPSB0aGlzLl9mb3JtLnF1ZXJ5U2VsZWN0b3JBbGwoJy5mb3JtX19pbnB1dCcpXG4gICAgdGhpcy5fc3VibWl0QnV0dG9uID0gdGhpcy5fZm9ybS5xdWVyeVNlbGVjdG9yKCcuZm9ybV9fc3VibWl0JylcbiAgICB0aGlzLl9zdWJtaXRCdXR0b25uVGV4dCA9IHRoaXMuX3N1Ym1pdEJ1dHRvbi50ZXh0Q29udGVudFxuICB9XG5cbiAgX2dldElucHV0VmFsdWVzKCkge1xuICAgIC8vIENyZWF0ZSBhbiBlbXB0eSBvYmplY3RcbiAgICBjb25zdCBmb3JtVmFsdWVzID0ge31cbiAgICAvLyBBZGQgdGhlIHZhbHVlcyBvZiB0aGUgZmllbGRzIHRvIHRoaXMgb2JqZWN0XG4gICAgdGhpcy5faW5wdXRMaXN0LmZvckVhY2goKGlucHV0KSA9PiB7XG4gICAgICBmb3JtVmFsdWVzW2lucHV0Lm5hbWVdID0gaW5wdXQudmFsdWVcbiAgICB9KVxuICAgIC8vIFJldHVybiB0aGUgdmFsdWVzIG9iamVjdFxuICAgIHJldHVybiBmb3JtVmFsdWVzXG4gIH1cbiAgLy8gYWRkIDIgcGFyYW1zOiBpc0xvYWRpbmcgYW5kIGxvYWRpbmdUZXh0IHdpdGggYSBkZWZhdWx0IHRleHRcbiAgcmVuZGVyTG9hZGluZyhpc0xvYWRpbmcsIGxvYWRpbmdUZXh0ID0gJ1NhdmluZy4uLicpIHtcbiAgICBpZiAoaXNMb2FkaW5nKSB7XG4gICAgICB0aGlzLl9zdWJtaXRCdXR0b24udGV4dENvbnRlbnQgPSBsb2FkaW5nVGV4dFxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9zdWJtaXRCdXR0b24udGV4dENvbnRlbnQgPSB0aGlzLl9zdWJtaXRCdXR0b25uVGV4dFxuICAgIH1cbiAgfVxuXG4gIHNldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXJzKClcbiAgICB0aGlzLl9mb3JtLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIChldnQpID0+IHtcbiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpXG4gICAgICB0aGlzLnJlbmRlckxvYWRpbmcodHJ1ZSlcbiAgICAgIHRoaXMuX2hhbmRsZVN1Ym1pdCh0aGlzLl9nZXRJbnB1dFZhbHVlcygpKVxuICAgIH0pXG4gIH1cblxuICBzZXRJbnB1dFZhbHVlcyhkYXRhKSB7XG4gICAgdGhpcy5faW5wdXRMaXN0LmZvckVhY2goKGlucHV0KSA9PiB7XG4gICAgICAvLyBoZXJlIHlvdSBpbnNlcnQgdGhlIGB2YWx1ZWAgYnkgdGhlIGBuYW1lYCBvZiB0aGUgaW5wdXRcbiAgICAgIGlucHV0LnZhbHVlID0gZGF0YVtpbnB1dC5uYW1lXVxuICAgIH0pXG4gIH1cblxuICBjbG9zZSgpIHtcbiAgICBzdXBlci5jbG9zZSgpXG4gICAgdGhpcy5fZm9ybS5yZXNldCgpXG4gIH1cbn1cbiIsIi8vXG4vLyBVc2luZyBDbGFzZXNzIGZvciB2YWxpZGF0aW9uXG4vL1xuZXhwb3J0IGNvbnN0IHZhbGlkYXRpb25TZXR0aW5ncyA9IHtcbiAgaW5wdXRTZWxlY3RvcjogJy5mb3JtX19pbnB1dCcsXG4gIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiAnLmZvcm1fX3N1Ym1pdCcsXG4gIGluYWN0aXZlQnV0dG9uQ2xhc3M6ICdmb3JtX19idXR0b25faW5hY3RpdmUnLFxuICBpbnB1dEVycm9yQ2xhc3M6ICdmb3JtX19pbnB1dF90eXBlX2Vycm9yJyxcbiAgZXJyb3JDbGFzczogJ2Zvcm1fX2lucHV0LWVycm9yX2FjdGl2ZScsXG4gIGZvcm1TZWxlY3RvcjogJy5mb3JtJyxcbn1cblxuLy8gQ2FyZCBUZW1wbGF0ZSBTZWxlY3RvclxuZXhwb3J0IGNvbnN0IGNhcmRUZW1wbGF0ZSA9ICcjY2FyZCdcblxuLy8gQ2FyZHMgY29udGFpbmVyXG5leHBvcnQgY29uc3QgY2FyZHNDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY2FyZHMnKVxuXG4vLyBQaWN0dXJlIGV4cGFuZGVkIG1vZGFsIHwgTW9kYWwgQ2FyZCBJbWFnZSB8IFBhcmFncmFwaCB0ZXh0XG5leHBvcnQgY29uc3QgcGljdHVyZU1vZGFsID0gJyNtb2RhbFBpY3R1cmUnXG5leHBvcnQgY29uc3QgbW9kYWxJbWFnZSA9ICcubW9kYWxfX3BpY3R1cmUtZnVsbCdcbmV4cG9ydCBjb25zdCBtb2RhbFBhcmFncmFwaCA9ICcubW9kYWxfX3BpdHVyZS1wYXJhZ3JhcGgnXG5cbi8vIFRoZSBwcm9maWxlIGVkaXQgbW9kYWwgfCBCdXR0b25cbmV4cG9ydCBjb25zdCBtb2RhbEVkaXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjbW9kYWxFZGl0JylcbmV4cG9ydCBjb25zdCBwcm9maWxlT3BlbkJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9maWxlX19uYW1lLWVkaXQnKVxuXG4vLyBUaGUgY2FyZCBhZGQgbW9kYWwgfCBCdXR0b25cbmV4cG9ydCBjb25zdCBtb2RhbEFkZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNtb2RhbEFkZCcpXG5leHBvcnQgY29uc3QgbW9kYWxBZGRPcGVuQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2ZpbGVfX2FkZC1idXR0b24nKVxuXG4vLyBUaGUgRGVsZXRlIENhcmQgTW9kYWwgfCBCdXR0b25cbmV4cG9ydCBjb25zdCBkZWxldGVDYXJkTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjbW9kYWxEZWxldGUnKVxuZXhwb3J0IGNvbnN0IGRlbGV0ZUNhcmRNb2RhbEJ1dHRvbiA9XG4gIGRlbGV0ZUNhcmRNb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2J1dHRvbi15ZXMnKVxuXG4vLyBUaGUgQXZhdGFyIE1vZGFsIHwgQnV0dG9uXG5leHBvcnQgY29uc3QgbW9kYWxBdmF0YXJFZGl0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI21vZGFsRWRpdEF2YXRhcicpXG5leHBvcnQgY29uc3QgYXZhdGFyQnV0dG9uRWRpdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9maWxlX19hdmF0YXItZWRpdCcpXG5leHBvcnQgY29uc3QgYXZhdGFySW1hZ2VTcmMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJvZmlsZV9fYXZhdGFyJylcblxuLy8gQVBJIFRva2VuXG5leHBvcnQgY29uc3QgQkFTRV9VUkwgPSAnaHR0cHM6Ly9hcm91bmQubm9tb3JlcGFydGllcy5jby92MS9ncm91cC0xMidcbmV4cG9ydCBjb25zdCBBVVRIX1RPS0VOID0gJzA0MzA0YTcxLWQ5YzAtNDliMi04MjgzLWNmYzJjNWFmZGY1MydcbiIsImltcG9ydCAnLi9pbmRleC5jc3MnXG5cbmltcG9ydCBBcGkgZnJvbSAnLi4vY29tcG9uZW50cy9BcGkuanMnXG5pbXBvcnQgRm9ybVZhbGlkYXRvciBmcm9tICcuLi9jb21wb25lbnRzL0Zvcm1WYWxpZGF0b3IuanMnXG5pbXBvcnQgQ2FyZCBmcm9tICcuLi9jb21wb25lbnRzL0NhcmQuanMnXG5pbXBvcnQgUG9wdXBXaXRoRm9ybSBmcm9tICcuLi9jb21wb25lbnRzL1BvcHVwV2l0aEZvcm0uanMnXG5pbXBvcnQgUG9wdXBXaXRoSW1hZ2UgZnJvbSAnLi4vY29tcG9uZW50cy9Qb3B1cFdpdGhJbWFnZS5qcydcbmltcG9ydCBQb3B1cERlbGV0ZUNhcmQgZnJvbSAnLi4vY29tcG9uZW50cy9Qb3B1cERlbGV0ZUNhcmQuanMnXG5pbXBvcnQgVXNlckluZm8gZnJvbSAnLi4vY29tcG9uZW50cy9Vc2VySW5mby5qcydcbmltcG9ydCBTZWN0aW9uIGZyb20gJy4uL2NvbXBvbmVudHMvU2VjdGlvbi5qcydcblxuaW1wb3J0IHtcbiAgdmFsaWRhdGlvblNldHRpbmdzLFxuICBjYXJkVGVtcGxhdGUsXG4gIHBpY3R1cmVNb2RhbCxcbiAgbW9kYWxJbWFnZSxcbiAgbW9kYWxQYXJhZ3JhcGgsXG4gIHByb2ZpbGVPcGVuQnV0dG9uLFxuICBtb2RhbEFkZE9wZW5CdXR0b24sXG4gIEJBU0VfVVJMLFxuICBBVVRIX1RPS0VOLFxuICBhdmF0YXJCdXR0b25FZGl0LFxufSBmcm9tICcuLi91dGlscy9jb25zdGFudHMuanMnXG5cbi8vIEFkZGluZyB0aGUgaW5pdGlhbHMgY2FyZHNcblxuY29uc3QgYXBpID0gbmV3IEFwaSh7XG4gIGJhc2VVcmw6IEJBU0VfVVJMLFxuICBoZWFkZXJzOiB7XG4gICAgYXV0aG9yaXphdGlvbjogQVVUSF9UT0tFTixcbiAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICB9LFxufSlcblxuLyoqLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSBcbiAqIENhcmQgU2VjdGlvblxuIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuLyoqXG4gKlxuICogQHBhcmFtIHtDYXJkfSBIYW5kbGluZyB0aGUgaGVhcnQgY2xpY2sgZXZlbnRcbiAqL1xuY29uc3QgaGFuZGxlSGVhcnRDbGljayA9IChjYXJkKSA9PiB7XG4gIGlmIChjYXJkLmdldENhcmRMaWtlU3RhdHVzKCkpIHtcbiAgICBhcGlcbiAgICAgIC5kZWxldGVDYXJkTGlrZShjYXJkLmdldElkKCkpXG4gICAgICAudGhlbigocmVzKSA9PiB7XG4gICAgICAgIGNhcmQudG9nZ2xlTGlrZUJ1dHRvbihyZXMubGlrZXMubGVuZ3RoKVxuICAgICAgfSlcbiAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKGVycilcbiAgICAgIH0pXG4gIH0gZWxzZSB7XG4gICAgYXBpXG4gICAgICAucHV0Q2FyZExpa2UoY2FyZC5nZXRJZCgpKVxuICAgICAgLnRoZW4oKHJlcykgPT4ge1xuICAgICAgICBjYXJkLnRvZ2dsZUxpa2VCdXR0b24ocmVzLmxpa2VzLmxlbmd0aClcbiAgICAgIH0pXG4gICAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhlcnIpXG4gICAgICB9KVxuICB9XG59XG5cbi8qKlxuICpcbiAqIEBwYXJhbSB7Q2FyZH0gSGFuZGxpbmcgdGhlIHRyYXNoIGNsaWNrIGV2ZW50XG4gKi9cbmNvbnN0IGhhbmRsZVRyYXNoQ2xpY2sgPSAoY2FyZCkgPT4ge1xuICBwb3B1cERlbGV0ZUNhcmQub3BlbihjYXJkKVxufVxuXG4vKipcbiAqXG4gKiBAcGFyYW0ge2V2dH0gSGFuZGxpbmcgdGhlIGltYWdlIGNsaWNrIGV2ZW50XG4gKi9cbmNvbnN0IGhhbmRsZUltYWdlQ2xpY2sgPSAoZXZ0KSA9PiB7XG4gIGltYWdlUG9wdXBNb2RhbC5vcGVuKGV2dC50YXJnZXQuc3JjLCBldnQudGFyZ2V0LmFsdClcbn1cblxuLy8gQ3JlYXRlIGEgY2FyZFxuZnVuY3Rpb24gY3JlYXRlQ2FyZChpdGVtLCBjdXJyZW50VXNlcklkKSB7XG4gIC8vIGhlcmUgeW91IGNyZWF0ZSBhIGNhcmRcbiAgY29uc3QgY2FyZCA9IG5ldyBDYXJkKFxuICAgIGl0ZW0sXG4gICAgY2FyZFRlbXBsYXRlLFxuICAgIGhhbmRsZUltYWdlQ2xpY2ssXG4gICAgaGFuZGxlVHJhc2hDbGljayxcbiAgICBjdXJyZW50VXNlcklkLFxuICAgIGhhbmRsZUhlYXJ0Q2xpY2tcbiAgKVxuICByZXR1cm4gY2FyZC5nZW5lcmF0ZUNhcmQoKVxufVxuXG4vKipcbiAqIEluaXRpYXRpbmcgU2VjdGlvbiBDbGFzc1xuICovXG5jb25zdCBjYXJkU2VjdGlvbiA9IG5ldyBTZWN0aW9uKFxuICB7XG4gICAgcmVuZGVyZXI6IGNyZWF0ZUNhcmQsXG4gIH0sXG4gICcuY2FyZHMnXG4pXG5cbi8qKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gXG4gKiBGb3JtIFZhbGlkYXRvciBDbGFzc2VzXG4gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuY29uc3QgZm9ybVZhbGlkYXRvcnMgPSB7fVxuXG4vLyBlbmFibGUgdmFsaWRhdGlvblxuY29uc3QgZW5hYmxlVmFsaWRhdGlvbiA9IChjb25maWcpID0+IHtcbiAgLy8gIE1ha2UgYSBsaXN0IG9mIGFsbCBmb3Jtc1xuICBjb25zdCBmb3JtTGlzdCA9IEFycmF5LmZyb20oZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChjb25maWcuZm9ybVNlbGVjdG9yKSlcblxuICAvLyAgRm9yIEVhY2ggRm9ybVxuICBmb3JtTGlzdC5mb3JFYWNoKChmb3JtRWxlbWVudCkgPT4ge1xuICAgIGNvbnN0IHZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKGNvbmZpZywgZm9ybUVsZW1lbnQpXG4gICAgLy8gaGVyZSB5b3UgZ2V0IHRoZSBuYW1lIG9mIHRoZSBmb3JtXG4gICAgY29uc3QgZm9ybU5hbWUgPSBmb3JtRWxlbWVudC5nZXRBdHRyaWJ1dGUoJ25hbWUnKVxuXG4gICAgLy8gaGVyZSB5b3Ugc3RvcmUgYSB2YWxpZGF0b3IgYnkgdGhlIGBuYW1lYCBvZiB0aGUgZm9ybVxuICAgIGZvcm1WYWxpZGF0b3JzW2Zvcm1OYW1lXSA9IHZhbGlkYXRvclxuICAgIHZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKClcbiAgfSlcbn1cbmVuYWJsZVZhbGlkYXRpb24odmFsaWRhdGlvblNldHRpbmdzKVxuXG4vKiotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIFxuICogSW5pdGlhdGluZyBQb3B1cFdpdGhJbWFnZSBDbGFzcyBGb3IgUGljdHVyZSBNb2RhbFxuIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cbmNvbnN0IGltYWdlUG9wdXBNb2RhbCA9IG5ldyBQb3B1cFdpdGhJbWFnZShcbiAgcGljdHVyZU1vZGFsLFxuICBtb2RhbEltYWdlLFxuICBtb2RhbFBhcmFncmFwaFxuKVxuaW1hZ2VQb3B1cE1vZGFsLnNldEV2ZW50TGlzdGVuZXJzKClcblxuLyoqLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSBcbiAqIEluaXRpYXRpbmcgUG9wdXBEbGV0ZUNhcmQgQ2xhc3MgRm9yIERlbGV0ZSBDYXJkIE1vZGFsXG4gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuY29uc3QgcG9wdXBEZWxldGVDYXJkID0gbmV3IFBvcHVwRGVsZXRlQ2FyZCgnI21vZGFsRGVsZXRlJywgKGNhcmQpID0+IHtcbiAgYXBpXG4gICAgLmRlbGV0ZUNhcmQoY2FyZC5nZXRJZCgpKVxuICAgIC50aGVuKCgpID0+IHtcbiAgICAgIC8vIGNvZGUgdG8gcmVtb3ZlIHRoZSBjYXJkIGVsZW1lbnQgZnJvbSB0aGUgRE9NXG4gICAgICBjYXJkLmRlbGV0ZUNhcmQoKVxuICAgICAgcG9wdXBEZWxldGVDYXJkLmNsb3NlKClcbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhlcnIpXG4gICAgfSlcbn0pXG5wb3B1cERlbGV0ZUNhcmQuc2V0RXZlbnRMaXN0ZW5lcnMoKVxuXG4vKiotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIFxuICogSW5pdGlhdGluZyBQb3B1cFdpdGhGb3JtIENsYXNzIEZvciBFZGl0IFByb2ZpbGUgTW9kYWxcbiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5jb25zdCB1c2VySW5mbyA9IG5ldyBVc2VySW5mbyh7XG4gIG5hbWVTZWxlY3RvcjogJy5wcm9maWxlX19uYW1lJyxcbiAgam9iU2VsZWN0b3I6ICcucHJvZmlsZV9fcm9sZScsXG4gIGF2YXRhclNlbGVjdG9yOiAnLnByb2ZpbGVfX2F2YXRhcicsXG59KVxuXG5jb25zdCBoYW5kbGVQcm9maWxlRm9ybVN1Ym1pdCA9IChkYXRhKSA9PiB7XG4gIGFwaVxuICAgIC5wYXRjaFVzZXJJbmZvKGRhdGEpXG4gICAgLnRoZW4oKHJlcykgPT4ge1xuICAgICAgdXNlckluZm8uc2V0VXNlckluZm8ocmVzKVxuICAgICAgcHJvZmlsZUVkaXRGb3JtUG9wdXAuY2xvc2UoKVxuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKGVycilcbiAgICB9KVxuICAgIC5maW5hbGx5KCgpID0+IHByb2ZpbGVFZGl0Rm9ybVBvcHVwLnJlbmRlckxvYWRpbmcoZmFsc2UpKVxufVxuXG5jb25zdCBwcm9maWxlRWRpdEZvcm1Qb3B1cCA9IG5ldyBQb3B1cFdpdGhGb3JtKFxuICBoYW5kbGVQcm9maWxlRm9ybVN1Ym1pdCxcbiAgJyNtb2RhbEVkaXQnXG4pXG5wcm9maWxlRWRpdEZvcm1Qb3B1cC5zZXRFdmVudExpc3RlbmVycygpXG5cbi8qKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gXG4gKiBJbml0aWF0aW5nIFBvcHVwV2l0aEZvcm0gQ2xhc3MgRm9yIEFkZGluZyBDYXJkIE1vZGFsXG4gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuLy8gSGFuZGxpbmcgc3VibWl0IGZ1bmN0aW9uIGZvciBtb2RhbCBjYXJkIGFkZFxuY29uc3QgaGFuZGxlQ2FyZEZvcm1TdWJtaXQgPSAoZGF0YSkgPT4ge1xuICBhcGlcbiAgICAucG9zdE5ld0NhcmQoZGF0YSlcbiAgICAudGhlbigocmVzKSA9PiB7XG4gICAgICBjYXJkU2VjdGlvbi5hZGRJdGVtKHJlcywgcmVzLm93bmVyLl9pZClcbiAgICAgIGNhcmRBZGRGb3JtUG9wdXAuY2xvc2UoKVxuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKGVycilcbiAgICB9KVxuICAgIC5maW5hbGx5KCgpID0+IGNhcmRBZGRGb3JtUG9wdXAucmVuZGVyTG9hZGluZyhmYWxzZSkpXG59XG5cbmNvbnN0IGNhcmRBZGRGb3JtUG9wdXAgPSBuZXcgUG9wdXBXaXRoRm9ybShoYW5kbGVDYXJkRm9ybVN1Ym1pdCwgJyNtb2RhbEFkZCcpXG5jYXJkQWRkRm9ybVBvcHVwLnNldEV2ZW50TGlzdGVuZXJzKClcblxuLyoqLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICogSW5pdGlhdGluZyBQb3B1cFdpdGhGb3JtIENsYXNzIEZvciBBdmF0YXIgRWRpdCBNb2RhbCAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG4vLyBIYW5kbGluZyBzdWJtaXQgZnVuY3Rpb24gZm9yIG1vZGFsIGF2YXJ0YXIgZWRpdFxuY29uc3QgaGFuZGxlQXZhdGFyRm9ybVN1Ym1pdCA9ICh7IGxpbms6IGF2YXRhciB9KSA9PiB7XG4gIGFwaVxuICAgIC5wYXRjaFVzZXJBdmF0YXIoeyBhdmF0YXIgfSlcbiAgICAudGhlbigocmVzKSA9PiB7XG4gICAgICB1c2VySW5mby5zZXRVc2VySW5mbyhyZXMpXG4gICAgICBhdmF0YXJNb2RhbFBvcHVwLmNsb3NlKClcbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhlcnIpXG4gICAgfSlcbiAgICAuZmluYWxseSgoKSA9PiBhdmF0YXJNb2RhbFBvcHVwLnJlbmRlckxvYWRpbmcoZmFsc2UpKVxufVxuXG5jb25zdCBhdmF0YXJNb2RhbFBvcHVwID0gbmV3IFBvcHVwV2l0aEZvcm0oXG4gIGhhbmRsZUF2YXRhckZvcm1TdWJtaXQsXG4gICcjbW9kYWxFZGl0QXZhdGFyJ1xuKVxuYXZhdGFyTW9kYWxQb3B1cC5zZXRFdmVudExpc3RlbmVycygpXG5cbi8qKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gXG4gKiBFdmVudCBIYW5kbGVycyB8IGFkZEV2ZW50TGlzdGVuZXJzXG4gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuLy8gVGhlIHByb2ZpbGUgZWRpdCBtb2RhbCB8IEJ1dHRvbiBsaXN0ZW5lclxuY29uc3QgaGFuZGxlRWRpdFByb2ZpbGVNb2RhbCA9ICgpID0+IHtcbiAgZm9ybVZhbGlkYXRvcnNbJ3Byb2ZpbGVGb3JtJ10ucmVzZXRWYWxpZGF0aW9uKClcbiAgcHJvZmlsZUVkaXRGb3JtUG9wdXAuc2V0SW5wdXRWYWx1ZXModXNlckluZm8uZ2V0VXNlckluZm8oKSlcbiAgcHJvZmlsZUVkaXRGb3JtUG9wdXAub3BlbigpXG59XG5wcm9maWxlT3BlbkJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZUVkaXRQcm9maWxlTW9kYWwpXG5cbi8qKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG4vLyBUaGUgY2FyZCBhZGQgbW9kYWwgfCBCdXR0b24gbGlzdGVybmVyXG5jb25zdCBoYW5kbGVBZGRDYXJkTW9kYWwgPSAoKSA9PiB7XG4gIGZvcm1WYWxpZGF0b3JzWydjYXJkRm9ybSddLnJlc2V0VmFsaWRhdGlvbigpXG4gIGNhcmRBZGRGb3JtUG9wdXAub3BlbigpXG59XG5tb2RhbEFkZE9wZW5CdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVBZGRDYXJkTW9kYWwpXG5cbi8qKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG4vLyBUaGUgYXZhdGFyIG1vZGFsIHwgQnV0dG9uIGxpc3Rlcm5lclxuY29uc3QgaGFuZGxlQXZhdGFyQ2xpY2sgPSAoKSA9PiB7XG4gIGZvcm1WYWxpZGF0b3JzWydhdmF0YXJGb3JtJ10ucmVzZXRWYWxpZGF0aW9uKClcbiAgYXZhdGFyTW9kYWxQb3B1cC5vcGVuKClcbn1cbmF2YXRhckJ1dHRvbkVkaXQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVBdmF0YXJDbGljaylcblxuLyoqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuLy8gQ2FsbGluZyB0aGUgY2FyZFNlY3Rpb24gcmVuZGVyIG1ldGhvZCB0byBwcmVwZW5kIHRoZSBjYXJkc1xuYXBpXG4gIC5sb2FkRGF0YSgpXG4gIC50aGVuKChkYXRhKSA9PiB7XG4gICAgY29uc3QgW3VzZXJEYXRhLCBjYXJkRGF0YV0gPSBkYXRhXG4gICAgY2FyZFNlY3Rpb24ucmVuZGVySW5pdGlhbENhcmRzKGNhcmREYXRhLCB1c2VyRGF0YS5faWQpXG4gICAgdXNlckluZm8uc2V0VXNlckluZm8odXNlckRhdGEpXG4gIH0pXG4gIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgY29uc29sZS5sb2coZXJyKVxuICB9KVxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQXBpIHtcbiAgY29uc3RydWN0b3Iob3B0aW9ucykge1xuICAgIHRoaXMuX2Jhc2VVcmwgPSBvcHRpb25zLmJhc2VVcmxcbiAgICB0aGlzLl9oZWFkZXJzID0gb3B0aW9ucy5oZWFkZXJzXG4gIH1cblxuICAvLyBoZXJlIGlzIHRoZSBjb2RlIG9mIHRoZSBjaGVja2luZyB0aGUgcmVzcG9uc2Ugc3RhdHVzXG4gIF9jaGVja1Jlc3BvbnNlKHJlcykge1xuICAgIGlmIChyZXMub2spIHtcbiAgICAgIHJldHVybiByZXMuanNvbigpXG4gICAgfVxuICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKVxuICB9XG5cbiAgX3JlcXVlc3QodXJsLCBvcHRpb25zKSB7XG4gICAgcmV0dXJuIGZldGNoKHVybCwgb3B0aW9ucykudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKVxuICB9XG5cbiAgLyoqXG4gICAqXG4gICAqIEByZXR1cm5zIHtQcm9taXNlfSBQcm9taXNlIG9iamVjdCByZXByZXNlbnRzIHRoZSByZXN1bHQgb2YgZmV0Y2hpbmcgdGhlIGluaXRpYWwgY2FyZHMgZnJvbSB0aGUgc2VydmVyXG4gICAqL1xuXG4gIGdldEluaXRpYWxDYXJkcygpIHtcbiAgICByZXR1cm4gdGhpcy5fcmVxdWVzdChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSlcbiAgfVxuXG4gIC8qKlxuICAgKlxuICAgKiBAcmV0dXJucyB7UHJvbWlzZX0gUHJvbWlzZSBvYmplY3QgcmVwcmVzZW50cyB0aGUgcmVzdWx0IG9mIGZldGNoaW5nIHRoZSB1c2VyIGluZm8gZnJvbSB0aGUgc2VydmVyXG4gICAqL1xuXG4gIGdldFVzZXJJbmZvKCkge1xuICAgIHJldHVybiB0aGlzLl9yZXF1ZXN0KGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KVxuICB9XG5cbiAgLyoqXG4gICAqXG4gICAqIEByZXR1cm5zIHtQcm9taXNlfSBQcm9taXNlIG9iamVjdCByZXByZXNlbnRzIHRoZSByZXN1bHQgb2YgZmV0Y2hpbmcgdGhlIHVzZXIgaW5mbyBhbmQgdGhlIGluaXRpYWwgY2FyZHMgZnJvbSB0aGUgc2VydmVyIHVzaW5nIFByb21pc2UuYWxsXG4gICAqL1xuICBsb2FkRGF0YSgpIHtcbiAgICByZXR1cm4gUHJvbWlzZS5hbGwoW3RoaXMuZ2V0VXNlckluZm8oKSwgdGhpcy5nZXRJbml0aWFsQ2FyZHMoKV0pXG4gIH1cblxuICAvKipcbiAgICpcbiAgICogQHBhcmFtIHt9IGRhdGEgdXNlciBpbmZvIHRvIGJlIHVwZGF0ZWRcbiAgICogQHJldHVybnMgVGhlIHVwZGF0ZSB1c2VyIGluZm8gZnJvbSB0aGUgc2VydmVyXG4gICAqL1xuXG4gIHBhdGNoVXNlckluZm8oZGF0YSkge1xuICAgIHJldHVybiB0aGlzLl9yZXF1ZXN0KGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xuICAgICAgbWV0aG9kOiAnUEFUQ0gnLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KGRhdGEpLFxuICAgIH0pXG4gIH1cblxuICAvKipcbiAgICpcbiAgICogQHBhcmFtIHsqfSBkYXRhIGNhcmQgaW5mbyB0byBiZSBwb3N0ZWRcbiAgICogQHJldHVybnNcbiAgICovXG5cbiAgcG9zdE5ld0NhcmQoZGF0YSkge1xuICAgIHJldHVybiB0aGlzLl9yZXF1ZXN0KGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xuICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoZGF0YSksXG4gICAgfSlcbiAgfVxuXG4gIC8qKlxuICAgKlxuICAgKiBAcGFyYW0geyp9IGNhcmRJZCBjYXJkIGlkIHRvIGJlIGRlbGV0ZWRcbiAgICogQHJldHVybnNcbiAgICovXG5cbiAgZGVsZXRlQ2FyZChjYXJkSWQpIHtcbiAgICByZXR1cm4gdGhpcy5fcmVxdWVzdChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy8ke2NhcmRJZH1gLCB7XG4gICAgICBtZXRob2Q6ICdERUxFVEUnLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KVxuICB9XG5cbiAgLyoqXG4gICAqXG4gICAqIEBwYXJhbSB7Kn0gY2FyZElkIGNhcmQgaWQgdG8gYmUgbGlrZWRcbiAgICogQHJldHVybnNcbiAgICovXG5cbiAgcHV0Q2FyZExpa2UoY2FyZElkKSB7XG4gICAgcmV0dXJuIHRoaXMuX3JlcXVlc3QoYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvbGlrZXMvJHtjYXJkSWR9YCwge1xuICAgICAgbWV0aG9kOiAnUFVUJyxcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSlcbiAgfVxuXG4gIC8qKlxuICAgKlxuICAgKiBAcGFyYW0geyp9IGNhcmQgaWQgdG8gYmUgdW5saWtlZFxuICAgKiBAcmV0dXJuc1xuICAgKi9cblxuICBkZWxldGVDYXJkTGlrZShjYXJkSWQpIHtcbiAgICByZXR1cm4gdGhpcy5fcmVxdWVzdChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy9saWtlcy8ke2NhcmRJZH1gLCB7XG4gICAgICBtZXRob2Q6ICdERUxFVEUnLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KVxuICB9XG5cbiAgLyoqXG4gICAqXG4gICAqIEBwYXJhbSB7Kn0gZGF0YSBhdmF0YXIgaW5mbyB0byBiZSB1cGRhdGVkXG4gICAqIEByZXR1bnMgVGhlIHVwZGF0ZWQgYXZhdGFyIGluZm8gZnJvbSB0aGUgc2VydmVyXG4gICAqL1xuXG4gIHBhdGNoVXNlckF2YXRhcihkYXRhKSB7XG4gICAgcmV0dXJuIHRoaXMuX3JlcXVlc3QoYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWUvYXZhdGFyYCwge1xuICAgICAgbWV0aG9kOiAnUEFUQ0gnLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KGRhdGEpLFxuICAgIH0pXG4gIH1cbn1cbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFNlY3Rpb24ge1xuICBjb25zdHJ1Y3Rvcih7IHJlbmRlcmVyIH0sIGNvbnRhaW5lclNlbGVjdG9yKSB7XG4gICAgdGhpcy5fcmVuZGVyZXIgPSByZW5kZXJlclxuICAgIHRoaXMuX2NvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoY29udGFpbmVyU2VsZWN0b3IpXG4gIH1cblxuICBhZGRJdGVtKGl0ZW0sIGN1cnJlbnRVc2VySWQpIHtcbiAgICBjb25zdCBjYXJkID0gdGhpcy5fcmVuZGVyZXIoaXRlbSwgY3VycmVudFVzZXJJZClcbiAgICB0aGlzLl9jb250YWluZXIucHJlcGVuZChjYXJkKVxuICB9XG5cbiAgcmVuZGVySW5pdGlhbENhcmRzKGNhcmRzLCBjdXJyZW50VXNlcklkKSB7XG4gICAgY2FyZHMuZm9yRWFjaCgoY2FyZCkgPT4ge1xuICAgICAgdGhpcy5hZGRJdGVtKGNhcmQsIGN1cnJlbnRVc2VySWQpXG4gICAgfSlcbiAgfVxufVxuIiwiY2xhc3MgRm9ybVZhbGlkYXRvciB7XG4gIGNvbnN0cnVjdG9yKHNldHRpbmdzLCBmb3JtRWxlbWVudCkge1xuICAgIHRoaXMuX2lucHV0U2VsZWN0b3IgPSBzZXR0aW5ncy5pbnB1dFNlbGVjdG9yXG4gICAgdGhpcy5fc3VibWl0QnV0dG9uU2VsZWN0b3IgPSBzZXR0aW5ncy5zdWJtaXRCdXR0b25TZWxlY3RvclxuICAgIHRoaXMuX2luYWN0aXZlQnV0dG9uQ2xhc3MgPSBzZXR0aW5ncy5pbmFjdGl2ZUJ1dHRvbkNsYXNzXG4gICAgdGhpcy5faW5wdXRFcnJvckNsYXNzID0gc2V0dGluZ3MuaW5wdXRFcnJvckNsYXNzXG4gICAgdGhpcy5fZXJyb3JDbGFzcyA9IHNldHRpbmdzLmVycm9yQ2xhc3NcbiAgICB0aGlzLl9mb3JtRWxlbWVudCA9IGZvcm1FbGVtZW50XG4gIH1cblxuICBfaGlkZUlucHV0RXJyb3IoaW5wdXRFbGVtZW50KSB7XG4gICAgdGhpcy5fZXJyb3JFbGVtZW50ID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgIGAuJHtpbnB1dEVsZW1lbnQuaWR9LWlucHV0LWVycm9yYFxuICAgIClcbiAgICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9pbnB1dEVycm9yQ2xhc3MpXG4gICAgdGhpcy5fZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5fZXJyb3JDbGFzcylcbiAgICB0aGlzLl9lcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSAnJ1xuICB9XG5cbiAgX3Nob3dJbnB1dEVycm9yKGlucHV0RWxlbWVudCwgZXJyb3JNZXNzYWdlKSB7XG4gICAgY29uc3QgZXJyb3JFbGVtZW50ID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgIGAuJHtpbnB1dEVsZW1lbnQuaWR9LWlucHV0LWVycm9yYFxuICAgIClcbiAgICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLl9pbnB1dEVycm9yQ2xhc3MpXG4gICAgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gZXJyb3JNZXNzYWdlXG4gICAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5fZXJyb3JDbGFzcylcbiAgfVxuXG4gIF9jaGVja0lucHV0VmFsaWRpdHkoaW5wdXRFbGVtZW50KSB7XG4gICAgaWYgKCFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQpIHtcbiAgICAgIHRoaXMuX3Nob3dJbnB1dEVycm9yKGlucHV0RWxlbWVudCwgaW5wdXRFbGVtZW50LnZhbGlkYXRpb25NZXNzYWdlKVxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9oaWRlSW5wdXRFcnJvcihpbnB1dEVsZW1lbnQpXG4gICAgfVxuICB9XG5cbiAgX2hhc0ludmFsaWRJbnB1dCgpIHtcbiAgICByZXR1cm4gdGhpcy5pbnB1dExpc3Quc29tZSgoaW5wdXQpID0+ICFpbnB1dC52YWxpZGl0eS52YWxpZClcbiAgfVxuXG4gIF90b2dnbGVCdXR0b25TdGF0ZSgpIHtcbiAgICBpZiAodGhpcy5faGFzSW52YWxpZElucHV0KHRoaXMuaW5wdXRMaXN0KSkge1xuICAgICAgdGhpcy5idXR0b25FbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5faW5hY3RpdmVCdXR0b25DbGFzcylcbiAgICAgIHRoaXMuYnV0dG9uRWxlbWVudC5kaXNhYmxlZCA9IHRydWVcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5idXR0b25FbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5faW5hY3RpdmVCdXR0b25DbGFzcylcbiAgICAgIHRoaXMuYnV0dG9uRWxlbWVudC5kaXNhYmxlZCA9IGZhbHNlXG4gICAgfVxuICB9XG5cbiAgX3NldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIHRoaXMuaW5wdXRMaXN0ID0gW1xuICAgICAgLi4udGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCh0aGlzLl9pbnB1dFNlbGVjdG9yKSxcbiAgICBdXG5cbiAgICB0aGlzLmJ1dHRvbkVsZW1lbnQgPSB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgdGhpcy5fc3VibWl0QnV0dG9uU2VsZWN0b3JcbiAgICApXG5cbiAgICB0aGlzLl90b2dnbGVCdXR0b25TdGF0ZSgpXG5cbiAgICB0aGlzLmlucHV0TGlzdC5mb3JFYWNoKChpbnB1dEVsZW1lbnQpID0+IHtcbiAgICAgIGlucHV0RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsICgpID0+IHtcbiAgICAgICAgdGhpcy5fY2hlY2tJbnB1dFZhbGlkaXR5KGlucHV0RWxlbWVudClcbiAgICAgICAgdGhpcy5fdG9nZ2xlQnV0dG9uU3RhdGUoKVxuICAgICAgfSlcbiAgICB9KVxuICB9XG5cbiAgcmVzZXRWYWxpZGF0aW9uKCkge1xuICAgIHRoaXMuX2Zvcm1FbGVtZW50LnJlc2V0KClcbiAgICB0aGlzLl90b2dnbGVCdXR0b25TdGF0ZSgpXG4gICAgdGhpcy5pbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XG4gICAgICB0aGlzLl9oaWRlSW5wdXRFcnJvcihpbnB1dEVsZW1lbnQpXG4gICAgfSlcbiAgfVxuXG4gIGVuYWJsZVZhbGlkYXRpb24oKSB7XG4gICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcnMoKVxuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEZvcm1WYWxpZGF0b3JcbiIsImltcG9ydCBQb3B1cCBmcm9tICcuL1BvcHVwLmpzJ1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cFdpdGhJbWFnZSBleHRlbmRzIFBvcHVwIHtcbiAgY29uc3RydWN0b3IocG9wdXBTZWxlY3RvciwgaW1hZ2VTZWxlY3RvciwgY2FwdGlvblNlbGVjdG9yKSB7XG4gICAgc3VwZXIocG9wdXBTZWxlY3RvcilcbiAgICB0aGlzLl9pbWFnZSA9IHRoaXMuX3BvcHVwRWxlbWVudC5xdWVyeVNlbGVjdG9yKGltYWdlU2VsZWN0b3IpXG4gICAgdGhpcy5fY2FwdGlvbiA9IHRoaXMuX3BvcHVwRWxlbWVudC5xdWVyeVNlbGVjdG9yKGNhcHRpb25TZWxlY3RvcilcbiAgfVxuXG4gIG9wZW4oaW1hZ2UsIGNhcHRpb24pIHtcbiAgICBzdXBlci5vcGVuKClcbiAgICB0aGlzLl9pbWFnZS5zcmMgPSBpbWFnZVxuICAgIHRoaXMuX2ltYWdlLmFsdCA9IGNhcHRpb25cbiAgICB0aGlzLl9jYXB0aW9uLnRleHRDb250ZW50ID0gY2FwdGlvblxuICB9XG59XG4iLCJpbXBvcnQgUG9wdXAgZnJvbSAnLi9Qb3B1cC5qcydcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXBEZWxldGVDYXJkIGV4dGVuZHMgUG9wdXAge1xuICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yLCBoYW5kbGVDYXJkRGVsZXRlKSB7XG4gICAgc3VwZXIocG9wdXBTZWxlY3RvcilcbiAgICB0aGlzLl9oYW5kbGVDYXJkRGVsZXRlID0gaGFuZGxlQ2FyZERlbGV0ZVxuICB9XG5cbiAgb3BlbihjYXJkKSB7XG4gICAgc3VwZXIub3BlbigpXG4gICAgdGhpcy5fY29uZmlybURlbGV0ZSA9ICgpID0+IHtcbiAgICAgIHRoaXMuX2hhbmRsZUNhcmREZWxldGUoY2FyZClcbiAgICB9XG5cbiAgICB0aGlzLl9wb3B1cEVsZW1lbnRcbiAgICAgIC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2J1dHRvbi15ZXMnKVxuICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5fY29uZmlybURlbGV0ZSlcbiAgfVxuXG4gIGNsb3NlKCkge1xuICAgIHN1cGVyLmNsb3NlKClcbiAgICB0aGlzLl9wb3B1cEVsZW1lbnRcbiAgICAgIC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2J1dHRvbi15ZXMnKVxuICAgICAgLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5fY29uZmlybURlbGV0ZSlcbiAgfVxufVxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgVXNlckluZm8ge1xuICBjb25zdHJ1Y3Rvcih7IG5hbWVTZWxlY3Rvciwgam9iU2VsZWN0b3IsIGF2YXRhclNlbGVjdG9yIH0pIHtcbiAgICB0aGlzLl9uYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihuYW1lU2VsZWN0b3IpXG4gICAgdGhpcy5fYWJvdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGpvYlNlbGVjdG9yKVxuICAgIHRoaXMuX2F2YXRhciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYXZhdGFyU2VsZWN0b3IpXG4gIH1cblxuICBnZXRVc2VySW5mbygpIHtcbiAgICByZXR1cm4ge1xuICAgICAgbmFtZTogdGhpcy5fbmFtZS50ZXh0Q29udGVudCxcbiAgICAgIGFib3V0OiB0aGlzLl9hYm91dC50ZXh0Q29udGVudCxcbiAgICAgIGF2YXRhcjogdGhpcy5fYXZhdGFyLnNyYyxcbiAgICB9XG4gIH1cblxuICBzZXRVc2VySW5mbyh7IG5hbWUsIGFib3V0LCBhdmF0YXIgfSkge1xuICAgIHRoaXMuX25hbWUudGV4dENvbnRlbnQgPSBuYW1lXG4gICAgdGhpcy5fYWJvdXQudGV4dENvbnRlbnQgPSBhYm91dFxuICAgIHRoaXMuX2F2YXRhci5zcmMgPSBhdmF0YXJcbiAgfVxufVxuIl0sIm5hbWVzIjpbImNvbnN0cnVjdG9yIiwicG9wdXBTZWxlY3RvciIsInRoaXMiLCJfcG9wdXBFbGVtZW50IiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiX2VzY0Nsb3NlSGFuZGxlciIsIl9oYW5kbGVFc2NDbG9zZSIsImJpbmQiLCJvcGVuIiwiY2xhc3NMaXN0IiwiYWRkIiwiYWRkRXZlbnRMaXN0ZW5lciIsImNsb3NlIiwicmVtb3ZlIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImV2dCIsImtleSIsInNldEV2ZW50TGlzdGVuZXJzIiwidGFyZ2V0IiwiY3VycmVudFRhcmdldCIsIlBvcHVwV2l0aEZvcm0iLCJQb3B1cCIsImhhbmRsZVN1Ym1pdCIsInN1cGVyIiwiX2hhbmRsZVN1Ym1pdCIsIl9mb3JtIiwiX2lucHV0TGlzdCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJfc3VibWl0QnV0dG9uIiwiX3N1Ym1pdEJ1dHRvbm5UZXh0IiwidGV4dENvbnRlbnQiLCJfZ2V0SW5wdXRWYWx1ZXMiLCJmb3JtVmFsdWVzIiwiZm9yRWFjaCIsImlucHV0IiwibmFtZSIsInZhbHVlIiwicmVuZGVyTG9hZGluZyIsImlzTG9hZGluZyIsImxvYWRpbmdUZXh0IiwicHJldmVudERlZmF1bHQiLCJzZXRJbnB1dFZhbHVlcyIsImRhdGEiLCJyZXNldCIsInByb2ZpbGVPcGVuQnV0dG9uIiwibW9kYWxBZGRPcGVuQnV0dG9uIiwiYXZhdGFyQnV0dG9uRWRpdCIsImFwaSIsIm9wdGlvbnMiLCJfYmFzZVVybCIsImJhc2VVcmwiLCJfaGVhZGVycyIsImhlYWRlcnMiLCJfY2hlY2tSZXNwb25zZSIsInJlcyIsIm9rIiwianNvbiIsIlByb21pc2UiLCJyZWplY3QiLCJzdGF0dXMiLCJfcmVxdWVzdCIsInVybCIsImZldGNoIiwidGhlbiIsImdldEluaXRpYWxDYXJkcyIsImdldFVzZXJJbmZvIiwibG9hZERhdGEiLCJhbGwiLCJwYXRjaFVzZXJJbmZvIiwibWV0aG9kIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJwb3N0TmV3Q2FyZCIsImRlbGV0ZUNhcmQiLCJjYXJkSWQiLCJwdXRDYXJkTGlrZSIsImRlbGV0ZUNhcmRMaWtlIiwicGF0Y2hVc2VyQXZhdGFyIiwiYXV0aG9yaXphdGlvbiIsImhhbmRsZUhlYXJ0Q2xpY2siLCJjYXJkIiwiZ2V0Q2FyZExpa2VTdGF0dXMiLCJnZXRJZCIsInRvZ2dsZUxpa2VCdXR0b24iLCJsaWtlcyIsImxlbmd0aCIsImNhdGNoIiwiZXJyIiwiY29uc29sZSIsImxvZyIsImhhbmRsZVRyYXNoQ2xpY2siLCJwb3B1cERlbGV0ZUNhcmQiLCJoYW5kbGVJbWFnZUNsaWNrIiwiaW1hZ2VQb3B1cE1vZGFsIiwic3JjIiwiYWx0IiwiY2FyZFNlY3Rpb24iLCJjb250YWluZXJTZWxlY3RvciIsInJlbmRlcmVyIiwiX3JlbmRlcmVyIiwiX2NvbnRhaW5lciIsImFkZEl0ZW0iLCJpdGVtIiwiY3VycmVudFVzZXJJZCIsInByZXBlbmQiLCJyZW5kZXJJbml0aWFsQ2FyZHMiLCJjYXJkcyIsImNhcmREYXRhIiwidGVtcGxhdGVTZWxlY3RvciIsImRlbGV0ZUNhcmRNb2RhbCIsIl9kZWxldGVDYXJkTW9kYWwiLCJfaGFuZGxlSGVhcnRDbGljayIsIl9jYXJkRGF0YSIsIl9jYXJkTmFtZSIsIl9jYXJkTGluayIsImxpbmsiLCJfY2FyZExpa2VzIiwiX2NhcmRJZCIsIl9pZCIsIl90ZW1wbGF0ZVNlbGVjdG9yIiwiX2hhbmRsZUltYWdlQ2xpY2siLCJfY3VycmVudFVzZXJJZCIsIl9nZXRUZW1wbGF0ZSIsImNvbnRlbnQiLCJjbG9uZU5vZGUiLCJfc2V0RXZlbnRMaXN0ZW5lcnMiLCJfY2FyZExpa2VCdXR0b24iLCJfaGFuZGxlSGVhcnRCdXR0b25DbGljayIsIl90cmFzaEJ1dHRvbiIsIl9oYW5kbGVUcmFzaEJ1dHRvbkNsaWNrIiwiX2NhcmRFbGVtZW50SW1hZ2UiLCJfY2FyZEVsZW1lbnQiLCJjb250YWlucyIsImNhcmRMaWtlcyIsInRvZ2dsZSIsIl9jYXJkRWxlbWVudExpa2VzIiwiZ2VuZXJhdGVDYXJkIiwiY2FyZEVsZW1lbnRUaXRsZSIsIm93bmVyIiwic29tZSIsImxpa2UiLCJmb3JtVmFsaWRhdG9ycyIsImNvbmZpZyIsImlucHV0U2VsZWN0b3IiLCJzdWJtaXRCdXR0b25TZWxlY3RvciIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJpbnB1dEVycm9yQ2xhc3MiLCJlcnJvckNsYXNzIiwiZm9ybVNlbGVjdG9yIiwiQXJyYXkiLCJmcm9tIiwiZm9ybUVsZW1lbnQiLCJ2YWxpZGF0b3IiLCJzZXR0aW5ncyIsIl9pbnB1dFNlbGVjdG9yIiwiX3N1Ym1pdEJ1dHRvblNlbGVjdG9yIiwiX2luYWN0aXZlQnV0dG9uQ2xhc3MiLCJfaW5wdXRFcnJvckNsYXNzIiwiX2Vycm9yQ2xhc3MiLCJfZm9ybUVsZW1lbnQiLCJfaGlkZUlucHV0RXJyb3IiLCJpbnB1dEVsZW1lbnQiLCJfZXJyb3JFbGVtZW50IiwiaWQiLCJfc2hvd0lucHV0RXJyb3IiLCJlcnJvck1lc3NhZ2UiLCJlcnJvckVsZW1lbnQiLCJfY2hlY2tJbnB1dFZhbGlkaXR5IiwidmFsaWRpdHkiLCJ2YWxpZCIsInZhbGlkYXRpb25NZXNzYWdlIiwiX2hhc0ludmFsaWRJbnB1dCIsImlucHV0TGlzdCIsIl90b2dnbGVCdXR0b25TdGF0ZSIsImJ1dHRvbkVsZW1lbnQiLCJkaXNhYmxlZCIsInJlc2V0VmFsaWRhdGlvbiIsImVuYWJsZVZhbGlkYXRpb24iLCJmb3JtTmFtZSIsImdldEF0dHJpYnV0ZSIsImltYWdlU2VsZWN0b3IiLCJjYXB0aW9uU2VsZWN0b3IiLCJfaW1hZ2UiLCJfY2FwdGlvbiIsImltYWdlIiwiY2FwdGlvbiIsImhhbmRsZUNhcmREZWxldGUiLCJfaGFuZGxlQ2FyZERlbGV0ZSIsIl9jb25maXJtRGVsZXRlIiwidXNlckluZm8iLCJuYW1lU2VsZWN0b3IiLCJqb2JTZWxlY3RvciIsImF2YXRhclNlbGVjdG9yIiwiX25hbWUiLCJfYWJvdXQiLCJfYXZhdGFyIiwiYWJvdXQiLCJhdmF0YXIiLCJzZXRVc2VySW5mbyIsInByb2ZpbGVFZGl0Rm9ybVBvcHVwIiwiZmluYWxseSIsImNhcmRBZGRGb3JtUG9wdXAiLCJhdmF0YXJNb2RhbFBvcHVwIiwidXNlckRhdGEiXSwic291cmNlUm9vdCI6IiJ9